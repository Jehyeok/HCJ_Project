<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<link rel="stylesheet" type="text/css" href="lib/default.css" />
	<script>
		/* 3주차 과제 */
		function add_list() {
			var color_list_div = document.querySelector("#color_list_div");
			var li_string = '<li class="sub_color"></li>'
			color_list_div.innerHTML = '<ul id="color_list">' +
									li_string + li_string + li_string + li_string +
									li_string + li_string + li_string + li_string +
									li_string + li_string +			
								'</ul>';

			var color_list_arr = document.querySelectorAll('li');
			for (i = 0, len = color_list_arr.length; i < len; i++) {
				color_list_arr[i].addEventListener('click', remove_list, false);
			}
		}

		function show_size () {
			var penSizeDiv = document.querySelector("#pen_size");
			var penShowSizeDiv = document.createElement('div');
			
			penShowSizeDiv.style.width = '80px';
			penShowSizeDiv.style.height = '60px';

			penSizeDiv.appendChild(penShowSizeDiv);

			var li_string = '<li class="sub_size"></li>'

			penShowSizeDiv.innerHTML = '<ul id="size_list">' +
									li_string + li_string +li_string +li_string
								'</ul>';

			var size_list_arr = document.querySelectorAll('li');
			for (i = 0, len = size_list_arr.length; i < len; i++) {
				size_list_arr[i].addEventListener('click', remove_list, false);
			}
		}

		function remove_list () {
			var penSizeDiv = document.getElementById('pen_size');
			penSizeDiv.innerHTML = "";
			console.log("remove_list");
		}

		function alertTest(e) {
				alert("hi~~");
				console.log(e.target.tagName, e.type, e.clientX);
				e.target.style.backgroundColor = "red";
				debugger;
		}

		function keydownTest(e) {
			alert(String.fromCharCode(e.keyCode));
			debugger;
		}

		function getPosX(e) {
			startPosX = e.pageX;
			console.log("dd");
			// return e.pageX;
		}

		function getPosY(e) {
			return e.pageY;
		}

		startPosX = 0;
		startPosY = 0;

		function drawRect(canvas) {
			// var startPosX = canvas.addEventListener('mousedown', getPosX, false);
			canvas.addEventListener('mousedown', getPosX, false);
			// var startPosY = canvas.addEventListener('mousedown', getPosY, false);
			// var endPosX = canvas.addEventListener('mouseup', getPosX, false);
			// var endPosY = canvas.addEventListener('mouseup', getPosY, false);
			// var width = getAbs(startPosX - endPosX);
			// var height = getAbs(startPosY - endPosY);

			// var context = canvas.getContext('2d');
			// context.beginPath();
			// context.fillRect(startPosX, startPosY, width, height);
			console.log(startPosX);
			// console.log(startPosY);
			// console.log(width);
			// console.log(height);
		}

		window.addEventListener('load', function() {
			// var arr = document.querySelectorAll("#aside");
			// console.log(arr.length);
			// for (i = 0 ; i < arr.length ; i++) {
			// 	console.log(arr[i].getAttribute("id"));
			// }
			
			var penSizeDiv = document.getElementById('pen_size');
			penSizeDiv.addEventListener('click', show_size, false);


			// var li_list = document.getElementsByTagName('li');
			// for( i = 0; i < li_list.length; i++) {
			// 	console.log(li_list.className);
			// }

			clickDiv = document.getElementById('click');
			clickDiv.addEventListener('click', alertTest, false);

			// var css_attr = document.defaultView.getComputedStyle(clickDiv)
			// console.log(css_attr.display); // block

			// if (css_attr.display == 'block') clickDiv.display = 'none';
			// else clickDiv.display = 'block';

			// var keydown_test_div = document.getElementById('keydown_test');
			// keydown_test_div.addEventListener('keydown', keydownTest, false);

			// var canvas = document.getElementById('myCanvas');
			
			// var context = canvas.getContext('2d');
			// context.beginPath();
			// context.moveTo(10, 10);
			// context.lineTo(50, 50);
			// context.closePath();
			// context.moveTo(60, 60);
			// context.lineTo(100, 100);
			// context.stroke();

			// var drawRectDiv = document.getElementById('draw_rect');
			// draw_rect.addEventListener('click', drawRect(canvas), false);

			var canvas, context;

			var tool;
			// var tool_default = 'rect';

		  	function init () {
			    // Find the canvas element.
		    	canvas = document.getElementById('myCanvas');
		    	context = canvas.getContext('2d');
		    	
		    	// Pencil tool instance.
		    	drawRectDiv = document.getElementById('draw_rect');
		    	drawRectDiv.addEventListener('click', ev_tool_change, false);

		    	drawPenDiv = document.getElementById('draw_pen');
		    	drawPenDiv.addEventListener('click', ev_tool_change, false);

		    	drawCircleDiv = document.getElementById('draw_circle');
		    	drawCircleDiv.addEventListener('click', ev_tool_change, false);

		    	// default
		    	tool = new tools['draw_pen']();
			    // Attach the mousedown, mousemove and mouseup event listeners.
			    canvas.addEventListener('mousedown', ev_canvas, false);
			    canvas.addEventListener('mousemove', ev_canvas, false);
			    canvas.addEventListener('mouseup',   ev_canvas, false);
			}

		  // This painting tool works like a drawing pencil which tracks the mouse 
		  // movements.

		  	function ev_tool_change (ev) {
		  		if (tools[this.id]) {
		  			tool = new tools[this.id]();
		  		}
		  	}

		  	var tools = {};

			tools.draw_pen = function () {
				var tool = this;
			    this.started = false;

			    // This is called when you start holding down the mouse button.
			    // This starts the pencil drawing.
			    this.mousedown = function (ev) {
			        context.beginPath();
			        context.moveTo(ev._x, ev._y);
			        tool.started = true;
				};

		    // This function is called every time you move the mouse. Obviously, it only 
		    // draws if the tool.started state is set to true (when you are holding down 
		    // the mouse button).
			    this.mousemove = function (ev) {
			      if (tool.started) {
			        context.lineTo(ev._x, ev._y);
			        context.stroke();
			      }
			    };

		    // This is called when you release the mouse button.
			    this.mouseup = function (ev) {
			      if (tool.started) {
			        tool.mousemove(ev);
			        tool.started = false;
			      }
			    };
		  	}

		  	tools.draw_rect = function () {
		  		var tool = this;
		  		this.started = false;

		  		this.mousedown = function (ev) {
			      tool.started = true;
			      tool.x0 = ev._x;
			      tool.y0 = ev._y;
			    };

			    this.mousemove = function (ev) {
			      if (!tool.started) {
			        return;
			      }

			      var x = Math.min(ev._x,  tool.x0),
			          y = Math.min(ev._y,  tool.y0),
			          w = Math.abs(ev._x - tool.x0),
			          h = Math.abs(ev._y - tool.y0);

			      context.clearRect(0, 0, canvas.width, canvas.height);

			      if (!w || !h) {
			        return;
			      }

			      context.strokeRect(x, y, w, h);
			    };

			    this.mouseup = function (ev) {
			      if (tool.started) {
			        tool.mousemove(ev);
			        tool.started = false;
			      }
			    };
		  	}

		  	tools.draw_circle = function () {
		  		var tool = this;
		  		this.started = false;

		  		this.mousedown = function (ev) {
			      tool.started = true;
			      tool.x0 = ev._x;
			      tool.y0 = ev._y;
			      context.beginPath();
			    };

			    this.mousemove = function (ev) {
				    if (!tool.started) {
				    	return;
				    }

				    var x = Math.min(ev._x,  tool.x0),
				        y = Math.min(ev._y,  tool.y0),
				        w = Math.abs(ev._x - tool.x0),
				        h = Math.abs(ev._y - tool.y0);

			    	context.clearRect(0, 0, canvas.width, canvas.height);

			        if (!w || !h) {
			        	return;
			        }

			        // context.strokeRect(x, y, w, h);
			        context.arc(x, y, w/2, 0, 2 * Math.PI, false);
			        context.stroke();
			    };

			    this.mouseup = function (ev) {
			    	if (tool.started) {
			        	tool.mousemove(ev);
			        	tool.started = false;
			    	}
			    };
		  	}
		  // The general-purpose event handler. This function just determines the mouse 
		  // position relative to the canvas element.
		 	function ev_canvas (ev) {
			    ev._x = ev.offsetX;
			    ev._y = ev.offsetY;

			    // Call the event handler of the tool.
			    var func = tool[ev.type];
			    if (func) {
			      func(ev);
			    }
			}

		init();

		}, false);
	</script>
</head>
<body>
	<div id="container">
		<header id="header">그림판</header>
		<div id="content">
			<aside id="aside">
				<div id="color_menu">
					<div id="now_color">
						<button id="add_ul_btn">add_ul</button>
					</div>
					<div id="color">
						<div id="color_list_div"></div>
						<div id="rgb">
							<div class="sub_rgb">
								<div class="letter_rgb">
								</div>
								<div class="slider_rgb">
								</div>
							</div>
							<div class="sub_rgb">
								<div class="letter_rgb">
								</div>
								<div class="slider_rgb">
								</div>
							</div>
							<div class="sub_rgb">
								<div class="letter_rgb">
								</div>
								<div class="slider_rgb">
								</div>
							</div>
						</div>
					</color>
					<div id="draw_pen">Pen</div>
					<div id="draw_rect">Rec</div>
					<div id="draw_circle">Circle</div>
					<div id="pen_size"></div>
				</div>
			</aside>
			<section id="section">
				<canvas id="myCanvas" width=786 height=500>

				</canvas>
			</section>
		</div>
		<footer id="footer">copyright</footer>
	</div>
	<div id="click">click</div>
	<form>
		<input type="text" id="keydown_test" />
	</form>
</body>
</html>